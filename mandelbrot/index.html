<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>
    <!-- Note the usage of `type=module` here as this is an ES6 module -->
    <script type="module">
      import init, { Mandelbrot} from './pkg/mandelbrot.js';

      function draw(wasm, mdlbrt) {
        
        const data_ptr = mdlbrt.data();
        const data = new Uint8Array(wasm.memory.buffer, data_ptr, mdlbrt.width() * mdlbrt.height());
        for (let row = 0; row < mdlbrt.height(); row++) {
          for (let col = 0; col < mdlbrt.width(); col++) {
            const idx = row * mdlbrt.width() + col;
            console.log(row, col, data[idx]);
          }
        }
      }
      
      async function run() {
        let wasm = await init();
        let mdlbrt = Mandelbrot.new();
        console.log(wasm, mdlbrt.width(),mdlbrt.height());
        draw(wasm,mdlbrt);
      }

      run();
    </script>
    
    <canvas id="drawing"></canvas>
  </body>
</html>

